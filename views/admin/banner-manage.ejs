<section class="content-main">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">Banners</h2>

        </div>
        <div>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
                Add banner
            </button>
        </div>
    </div>




    <!-- modal -->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Add banner</h5>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <section class="">
                        <div class="container d-flex justify-content-center">
                            <div class="row w-75 mt-5">
                                <div class="col-md-12">

                                    <form action="/admin/add-banner" method="POST" enctype="multipart/form-data">

                                        <label for="">Title</label>
                                        <input type="text" name="title" class="form-control" required />

                                        <label for="">Description</label>
                                        <input type="text" name="description" class="form-control" required />

                                        <label for="">Link</label>
                                        <input type="text" name="link" class="form-control" />

                                        <label for="">Image</label>
                                        <input type="file" name="bannerImg" class="form-control" required accept="jpeg,jpg,png" />

                                        <label for="">Image</label>
                                        <input type="file" name="bannerImg" class="form-control" required accept="jpeg,jpg,png"/>

                                        <label for="">Image</label>
                                        <input type="file" name="bannerImg" class="form-control" required accept="jpeg,jpg,png"/>

                                        <button type="submit" class="btn btn-success mt-4">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>


                </div>
                <!-- <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                      <button type="submit" class="btn btn-primary " onclick="checkDuplicate()" >Submit</button>
                    </div> -->

            </div>
        </div>
    </div>


    <!-- edit banner -->
    <div class="modal fade" id="editBannerModalCenter" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Edit banner</h5>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <section class="">
                        <div class="container d-flex justify-content-center">
                            <div class="row w-75 mt-5">
                                <div class="col-md-12">

                                    <form id="requierdBannerIdForm" enctype="multipart/form-data">

                                        <label for="">Title</label>
                                        <input type="text" name="title" class="form-control" id="title" value="" required />

                                        <input type="text" id="requiredBannerId" name="id" value=""
                                            style="display: none;" >

                                        <label for="">Description</label>
                                        <input type="text" name="description" class="form-control" id="description"
                                            value="" required/>

                                        <label for="">Link</label>
                                        <input type="text" name="link" class="form-control" id="link" value="" />

                                        <label for="">Image 1</label>
                                        <!-- <img  alt="" style="width:80px;height:auto" id="bannerImgView1" class="mt-3 mb-3"> -->
                                        <input type="file" name="bannerEditImg1" class="form-control" id="bannerImg1" accept=".jpeg,.jpg,.png" />

                                        <label for="">Image 2</label>
                                        <input type="file" name="bannerEditImg2" class="form-control" id="bannerImg2" accept=".jpeg,.jpg,.png" />

                                        <label for="">Image 3</label>
                                        <input type="file" name="bannerEditImg3" class="form-control" id="bannerImg3" accept=".jpeg,.jpg,.png" />

                                        <button onclick="editBanner()" class="btn btn-primary">Update</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>


                </div>
                <!-- <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary " onclick="checkDuplicate()" >Submit</button>
                </div> -->

            </div>
        </div>
    </div>



    <!-- table start -->
    <div class="card mb-4">

        <!-- card-header end// -->
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th class="align-middle" scope="col">No.</th>
                            <th class="align-middle" scope="col">Banner name</th>
                            <th class="align-middle" scope="col">Image</th>
                            <th class="align-middle" scope="col">status</th>
                            <th class="align-middle" scope="col">Option</th>
                        </tr>
                    </thead>
                    <tbody>

                        <% viewBanners.forEach(function(viewBanners,index){ %>

                            <tr>
                                <td>
                                    <%= index+1 %>
                                </td>

                                <td>
                                    <%= viewBanners.title %>
                                </td>

                                <td>
                                    <img src="/uploads/<%=viewBanners.image[0]%>" alt="" style="width:60px;height:50px"
                                        class="mt-3 mb-3">
                                </td>
                                <td>
                                    <%= viewBanners.state %>
                                </td>
                                <td>


                                    <button class="btn btn-md rounded font-sm" id="deleteBanner" name="deleteBanner"
                                        onclick="deleteBanner('<%= viewBanners._id %>')">

                                        Delete
                                    </button>


                                    <button onclick="findBanner('<%= viewBanners._id %>')"
                                        class="btn btn-md rounded font-sm" data-toggle="modal"
                                        data-target="#editBannerModalCenter">
                                        Edit
                                    </button>

                                    <%if(!viewBanners.status){%>
                                        <button onclick="ListBanner('<%= viewBanners._id %>')" name="listBanner"
                                            id="listBanner" class="btn btn-md rounded font-sm">
                                            List
                                        </button>

                                        <%} else{%>
                                            <button onclick="unListBanner('<%= viewBanners._id %>')" name="listBanner"
                                                id="listBanner" class="btn btn-md rounded font-sm">
                                                Unlist
                                            </button>

                                            <%} %>




                                </td>

                            </tr>
                            <% })%>

                    </tbody>
                </table>
            </div> <!-- table-responsive//end -->
        </div>
        <!-- card-body end// -->
    </div>

    <div class="pagination-area mt-15 mb-50">
        <nav aria-label="Page navigation example">
            <ul class="pagination justify-content-start">

                <% for(let i=1; i <=pages ; i++) { %>
                    <li class="page-item"><a class="page-link" href="?page=<%= i %>" id="pagination">
                            <%= i %>
                        </a></li>

                    <% } %>
            </ul>
        </nav>
    </div>
</section> <!-- content-main end// -->


<script>

    function findBanner(id) {
        document.getElementById('requiredBannerId').value = id
        $.ajax({
            url: '/admin/get-banner',
            type: 'get',
            data: {
                id
            },
            success: function (data) {
                console.log(data);
                document.getElementById('title').value = data.title
                document.getElementById('description').value = data.description
                document.getElementById('link').value = data.link
                // document.getElementById('bannerImgView1').src = "uploads/data.image[0]"

            }
        })

    }

    function editBanner() {

        var formData = new FormData(document.getElementById('requierdBannerIdForm'));
        $.ajax({
            url: '/admin/edit-banner',
            type: 'put',
            data: formData,
            processData: false,
            contentType: false,
            success: function () {
                location.reload()
            }
        })
    }

    function ListBanner(id) {

        $.ajax({
            url: '/admin/list-banner',
            type: 'put',
            data: {
                id
            },

            success: function () {
                location.reload()

            }
        })

    }
    function unListBanner(id) {

        $.ajax({
            url: '/admin/unlist-banner',
            type: 'put',
            data: {
                id
            },

            success: function () {
                location.reload()

            }
        })

    }


    function deleteBanner(id) {

        Swal.fire({
            title: "Are you sure?",
            text: "You wont be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Yes, delete it!"
        }).then(function (result) {
            if (result.value) {
                $.ajax({
                    type: "delete",
                    url: '/admin/delete-banner',
                    data: {
                        id: id
                    },
                    success: (response) => {
                        Swal.fire(
                            "Deleted!",
                            "Banner deleted.",
                            "success"
                        ).then(function () { location.reload() })
                    }
                });

            }
        })
    }






</script>