<!-- //ajax link  -->
<script src="/assets/js/addToCart-ajax.js"></script>



<% if (total==0) { %>
    <!-- content to render if condition is true -->
    <div class="container-fluid">
        <div class="row">

            <div class="col-md-12">

                <!-- <div class="card"> -->

                <div class="card-body cart">
                    <div class="col-sm-12 empty-cart-cls text-center">
                        <img src="https://i.imgur.com/dCdflKN.png" width="130" height="130" class="img-fluid mb-4 mr-3">
                        <h3><strong>Your Cart is Empty</strong></h3>
                        <h4>Add something to cart</h4>
                        <a href="/shop" class="btn btn-primary cart-btn-transform m-3" data-abc="true">continue
                            shopping</a>


                    </div>
                </div>
                <!-- </div> -->


            </div>

        </div>

    </div>





    <% } else { %>
        <!-- content to render if condition is false -->
        <main class="main">
            <div class="page-header breadcrumb-wrap">
                <div class="container">
                    <div class="breadcrumb">
                        <a href="/" rel="nofollow">Home</a>
                        <span></span> Shop
                        <span></span> Your Cart
                    </div>
                </div>
            </div>











            <section class="mt-50 mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <div class="table-responsive">
                                <table class="table shopping-summery text-center clean">
                                    <thead>
                                        <tr class="main-heading">
                                            <th scope="col">Image</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Subtotal</th>
                                            <th scope="col">Remove</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        <% for(let i=0;i < count;i++){%>
                                            <tr>
                                                <td class="image product-thumbnail"><img
                                                        src="/uploads/<%=response.cart.product[i]._id.Image[0] %>"
                                                        alt="#"></td>
                                                <td class="product-des product-name">
                                                    <h5 class="product-name"><a
                                                            href="/shop-product/<%=response.cart.product[i]._id._id%>">
                                                            <%=response.cart.product[i]._id.Productname %>
                                                        </a></h5>
                                                    <p class="font-xs">
                                                        <%=response.cart.product[i]._id.ProductDescription %><br>
                                                    </p>
                                                </td>
                                                <td class="price" data-title="Price">₹<span
                                                        id="price<%=response.cart.product[i]._id._id %>">
                                                        <%=response.cart.product[i]._id.Price %>
                                                    </span></td>
                                                <td class="text-center" data-title="Stock">
                                                    <div class="detail-qty border radius  m-auto">
                                                        <button class="qty-down"
                                                            onclick="quantityUpdate('<%=response.cart.product[i]._id._id %>','<%=response.cart.product[i]._id.Price%>',-1),total ('<%=response.cart.userId %>')"><i
                                                                class="fi-rs-angle-small-down"></i></button>
                                                        <span class="qty-val"
                                                            id="qty<%=response.cart.product[i]._id._id %>">
                                                            <%=response.cart.product[i].quantity %>
                                                        </span>

                                                        <button class="qty-up"
                                                            onclick="quantityUpdate('<%=response.cart.product[i]._id._id %>','<%=response.cart.product[i]._id.Price%>',1),total ('<%=response.cart.userId %>')"><i
                                                                class="fi-rs-angle-small-up"></i></button>
                                                    </div>
                                                </td>
                                                <td class="text-right" data-title="Cart">
                                                    ₹<span id="subTotal<%=response.cart.product[i]._id._id %>">
                                                        <%=(parseInt(response.cart.product[i].quantity) *
                                                            parseInt(response.cart.product[i]._id.Price))%>
                                                    </span>
                                                </td>
                                                <td class="action" data-title="Remove"><a
                                                        onclick="deleteTheProduct('<%=response.cart.product[i]._id._id%>')"
                                                        class="text-muted"><i class="fi-rs-trash"></i></a></td>
                                            </tr>

                                            <%} %>



                                                <!-- <tr>
                                        <td class="image"><img src="assets/imgs/shop/product-11-2.jpg" alt="#"></td>
                                        <td class="product-des">
                                            <h5 class="product-name"><a href="shop-product-right.html">Amazon Essentials
                                                    Women's Tank</a></h5>
                                            <p class="font-xs">Sit at ipsum amet clita no est,<br> sed amet sadipscing et
                                                gubergren</p>
                                        </td>
                                        <td class="price" data-title="Price"><span>$75.00 </span></td>
                                        <td class="text-center" data-title="Stock">
                                            <div class="detail-qty border radius  m-auto">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val">2</span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                        </td>
                                        <td class="text-right" data-title="Cart">
                                            <span>$150.00 </span>
                                        </td>
                                        <td class="action" data-title="Remove"><a href="#" class="text-muted"><i
                                                    class="fi-rs-trash"></i></a></td>
                                    </tr>
                                    <tr>
                                        <td class="image"><img src="assets/imgs/shop/product-6-1.jpg" alt="#"></td>
                                        <td class="product-des">
                                            <h5 class="product-name"><a href="shop-product-right.html">Amazon Brand - Daily
                                                    Ritual Women's Jersey </a></h5>
                                            <p class="font-xs">Erat amet et et amet diam et et.<br> Justo amet at dolore
                                            </p>
                                        </td>
                                        <td class="price" data-title="Price"><span>$62.00 </span></td>
                                        <td class="text-center" data-title="Stock">
                                            <div class="detail-qty border radius  m-auto">
                                                <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                <span class="qty-val">1</span>
                                                <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                            </div>
                                        </td>
                                        <td class="text-right" data-title="Cart">
                                            <span>$62.00 </span>
                                        </td>
                                        <td class="action" data-title="Remove"><a href="#" class="text-muted"><i
                                                    class="fi-rs-trash"></i></a></td>
                                    </tr> -->
                                                <!-- <tr>
                                        <td colspan="6" class="text-end">
                                            <a href="#" class="text-muted"> <i class="fi-rs-cross-small"></i> Clear Cart</a>
                                        </td>
                                    </tr> -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="cart-action text-end">
                                <!-- <a class="btn  mr-10 mb-sm-15"><i class="fi-rs-shuffle mr-10"></i>Update Cart</a> -->
                                <a href="/shop" class="btn "><i class="fi-rs-shopping-bag mr-10"></i>Continue
                                    Shopping</a>
                            </div>
                            <div class="divider center_icon mt-50 mb-50"></div>
                            <div class="row mb-50">
                                <div class="col-lg-6 col-md-12">

                                    <!-- <div class="mb-30 mt-50">
                            <div class="heading_s1 mb-3">
                                <h4>Apply Coupon</h4>
                            </div>
                            <div class="total-amount">
                                <div class="left">
                                    <div class="coupon">
                                        <form action="#" target="_blank">
                                            <div class="form-row row justify-content-center">
                                                <div class="form-group col-lg-6">
                                                    <input class="font-medium" name="Coupon"
                                                        placeholder="Enter Your Coupon">
                                                </div>
                                                <div class="form-group col-lg-6">
                                                    <button class="btn  btn-sm"><i
                                                            class="fi-rs-label mr-10"></i>Apply</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                                </div>






                                <div class="col-lg-6 col-md-12">
                                    <div class="border p-md-4 p-30 border-radius cart-totals">
                                        <div class="heading_s1 mb-3">
                                            <h4>Cart Total</h4>
                                        </div>
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody>
                                                    <!-- <tr>
                                            <td class="cart_total_label">Cart Subtotal</td>
                                            <td class="cart_total_amount"><span
                                                    class="font-lg fw-900 text-brand">$240.00</span></td>
                                        </tr> -->
                                                    <tr>
                                                        <td class="cart_total_label">Shipping</td>
                                                        <td class="cart_total_amount"> <i class="ti-gift mr-5"></i> Free
                                                            Shipping</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="cart_total_label">Total</td>
                                                        <td class="cart_total_amount"><strong><span
                                                                    class="font-xl fw-900 text-brand" id="total">
                                                                    <%=locals.total.toLocaleString('en-IN', {
                                                                        style: 'currency' , currency: 'INR' })%>
                                                                </span></strong></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <a href="/checkout" class="btn "> <i class="fi-rs-box-alt mr-10"></i> Proceed To
                                            CheckOut</a>
                                    </div>
                                </div>







                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <% } %>


            <input type="hidden" id="count" value="<%=count%>">




            <script>
                function quantityUpdate(id, price, count) {
                    let qty = document.getElementById('qty' + id).innerHTML
                    let coun = parseInt(count)
                    let quantity = parseInt(qty)
                    //subtotall calc
                    const totalQuant = coun + quantity
                    let subt = (totalQuant * price)
                    console.log(subt);
                    if (coun == -1 && quantity == 1) {
                        swal({
                            title: "Are you sure?",
                            text: "Once deleted, you will not be able to recover the product!",
                            icon: "warning",
                            buttons: true,
                            dangerMode: true,
                        })
                            .then((willDelete) => {
                                if (willDelete) {
                                    $.ajax({
                                        url: '/update-cart',
                                        type: 'POST',
                                        data: {
                                            proId: id,
                                            quantity: quantity,
                                            count: coun,
                                            price: price,
                                            subtotal: subt
                                        },
                                        success: function (response) {
                                            if (response) {
                                                location.reload()
                                            }
                                        }
                                    })
                                    swal("Your product is deleted!", {
                                        icon: "success",
                                    });
                                } else {
                                    swal("Canceled");
                                }
                            });
                    } else {
                        $.ajax({
                            url: '/update-cart',
                            type: 'POST',
                            data: {
                                proId: id,
                                quantity: quantity,
                                count: coun,
                                price: price,
                                subtotal: subt
                            },
                            success: function () {
                                console.log(subt, 'insideresponse');
                                document.getElementById('subTotal' + id).innerHTML = subt
                            }
                        })
                    }
                }
                // total 
                function total(id) {
                    $.ajax({
                        url: '/cart-total',
                        type: 'GET',
                        data: {
                            userId: id
                        },
                        success: function (total) {
                            document.getElementById('total').innerHTML = total[0].total
                        }
                    })
                }
                function deleteTheProduct(id) {
                    swal({
                        title: "Are you sure?",
                        text: "Once deleted, you will not be able to recover the product!",
                        icon: "warning",
                        buttons: true,
                        dangerMode: true,
                    })
                        .then((willDelete) => {
                            if (willDelete) {
                                $.ajax({
                                    url: '/delete-product-cart',
                                    type: 'delete',
                                    data: {
                                        proId: id
                                    },
                                    success: function (response) {
                                        if (response) {
                                            location.reload()
                                        }
                                    }
                                })
                                swal("Your product is deleted!", {
                                    icon: "success",
                                });
                            } else {
                                swal("Canceled");
                            }
                        });
                }
            </script>